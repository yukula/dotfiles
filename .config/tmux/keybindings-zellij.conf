# Zellij-like keybindings for tmux 3.2a
#
# Design goals:
# - Prefix (Ctrl-a) acts as a "mode switcher".
# - Modes are implemented via custom key tables.
# - Alt-h/j/k/l (and Alt-arrows) navigate panes always-on.

##### Prefix -> enter modes
# (we unbind defaults that conflict so the Zellij-like scheme wins)
unbind-key -T prefix p
unbind-key -T prefix t
unbind-key -T prefix r
unbind-key -T prefix m
unbind-key -T prefix o
unbind-key -T prefix s
unbind-key -T prefix q

# Pane mode
bind-key -T prefix p switch-client -T z_pane
# Tab (window) mode
bind-key -T prefix t switch-client -T z_tab
# Resize mode
bind-key -T prefix r switch-client -T z_resize
# Move mode
bind-key -T prefix m switch-client -T z_move
# Scroll mode (tmux copy-mode)
bind-key -T prefix s copy-mode -e
# Session mode
bind-key -T prefix o switch-client -T z_session

# Detach (your choice for "quit")
bind-key -T prefix q detach-client

# Send literal Ctrl-a to the application
bind-key -T prefix C-a send-prefix

##### Exit helpers: Esc/Enter leave mode
bind-key -T z_pane Escape switch-client -T root
bind-key -T z_tab Escape switch-client -T root
bind-key -T z_resize Escape switch-client -T root
bind-key -T z_move Escape switch-client -T root
bind-key -T z_session Escape switch-client -T root

bind-key -T z_pane Enter switch-client -T root
bind-key -T z_tab Enter switch-client -T root
bind-key -T z_resize Enter switch-client -T root
bind-key -T z_move Enter switch-client -T root
bind-key -T z_session Enter switch-client -T root

##### Pane mode (C-a p ...)
# Focus movement
bind-key -T z_pane h select-pane -L
bind-key -T z_pane j select-pane -D
bind-key -T z_pane k select-pane -U
bind-key -T z_pane l select-pane -R
bind-key -T z_pane Left select-pane -L
bind-key -T z_pane Down select-pane -D
bind-key -T z_pane Up select-pane -U
bind-key -T z_pane Right select-pane -R

# Splits
# - C-a p n : new pane (split right)
# - C-a p r : split right
# - C-a p d : split down
bind-key -T z_pane n split-window -h -c '#{pane_current_path}'
bind-key -T z_pane r split-window -h -c '#{pane_current_path}'
bind-key -T z_pane d split-window -v -c '#{pane_current_path}'

# Close focused pane
bind-key -T z_pane x kill-pane

# Switch focus (last pane)
bind-key -T z_pane p last-pane

# Rename pane (pane title)
bind-key -T z_pane c command-prompt -I '#{pane_title}' "select-pane -T '%%'"

##### Tab (window) mode (C-a t ...)
# Previous/next window
bind-key -T z_tab h previous-window
bind-key -T z_tab k previous-window
bind-key -T z_tab Left previous-window
bind-key -T z_tab Up previous-window

bind-key -T z_tab l next-window
bind-key -T z_tab j next-window
bind-key -T z_tab Right next-window
bind-key -T z_tab Down next-window

# Jump to window 1-9
bind-key -T z_tab 1 select-window -t :1
bind-key -T z_tab 2 select-window -t :2
bind-key -T z_tab 3 select-window -t :3
bind-key -T z_tab 4 select-window -t :4
bind-key -T z_tab 5 select-window -t :5
bind-key -T z_tab 6 select-window -t :6
bind-key -T z_tab 7 select-window -t :7
bind-key -T z_tab 8 select-window -t :8
bind-key -T z_tab 9 select-window -t :9

# Create/rename/close window
bind-key -T z_tab n new-window -c '#{pane_current_path}'
bind-key -T z_tab r command-prompt -I '#{window_name}' "rename-window '%%'"
bind-key -T z_tab x kill-window

# Sync panes in window (closest to Zellij sync tab)
bind-key -T z_tab s setw -t : synchronize-panes

# Toggle between last and current window
bind-key -T z_tab Tab last-window

# Break pane into its own window (closest to Zellij break pane)
bind-key -T z_tab b break-pane

##### Resize mode (C-a r ...)
# Mark as repeatable (-r) so you can hold the key down.
bind-key -r -T z_resize h resize-pane -L 5
bind-key -r -T z_resize j resize-pane -D 5
bind-key -r -T z_resize k resize-pane -U 5
bind-key -r -T z_resize l resize-pane -R 5
bind-key -r -T z_resize Left resize-pane -L 5
bind-key -r -T z_resize Down resize-pane -D 5
bind-key -r -T z_resize Up resize-pane -U 5
bind-key -r -T z_resize Right resize-pane -R 5

##### Move mode (C-a m ...)
# Implemented as swaps with adjacent panes (tmux provides pane_left/right/up/down).
# If there is no adjacent pane in that direction, do nothing.
bind-key -T z_move h if-shell -F '#{pane_at_left}' 'display-message ""' 'swap-pane -t "#{pane_left}" \; select-pane -L'
bind-key -T z_move j if-shell -F '#{pane_at_bottom}' 'display-message ""' 'swap-pane -t "#{pane_down}" \; select-pane -D'
bind-key -T z_move k if-shell -F '#{pane_at_top}' 'display-message ""' 'swap-pane -t "#{pane_up}" \; select-pane -U'
bind-key -T z_move l if-shell -F '#{pane_at_right}' 'display-message ""' 'swap-pane -t "#{pane_right}" \; select-pane -R'

bind-key -T z_move Left if-shell -F '#{pane_at_left}' 'display-message ""' 'swap-pane -t "#{pane_left}" \; select-pane -L'
bind-key -T z_move Down if-shell -F '#{pane_at_bottom}' 'display-message ""' 'swap-pane -t "#{pane_down}" \; select-pane -D'
bind-key -T z_move Up if-shell -F '#{pane_at_top}' 'display-message ""' 'swap-pane -t "#{pane_up}" \; select-pane -U'
bind-key -T z_move Right if-shell -F '#{pane_at_right}' 'display-message ""' 'swap-pane -t "#{pane_right}" \; select-pane -R'

##### Session mode (C-a o ...)
# Detach
bind-key -T z_session d detach-client

# Popup session/window/pane picker
bind-key -T z_session w display-popup -E -w 90% -h 90% "tmux" "choose-tree" "-s"

# Popup edit tmux config
bind-key -T z_session c display-popup -E -w 90% -h 90% "sh" "-lc" "#{?#{env:EDITOR},#{env:EDITOR},vi} #{env:HOME}/.tmux.conf"

##### Always-on Alt navigation
# Zellij-style: left/right fall back to prev/next window when at edge.

bind-key -n M-h if-shell -F "#{pane_at_left}" "previous-window" "select-pane -L"
bind-key -n M-l if-shell -F "#{pane_at_right}" "next-window" "select-pane -R"
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U

bind-key -n M-Left if-shell -F "#{pane_at_left}" "previous-window" "select-pane -L"
bind-key -n M-Right if-shell -F "#{pane_at_right}" "next-window" "select-pane -R"
bind-key -n M-Down select-pane -D
bind-key -n M-Up select-pane -U

# Move window left/right (Zellij Alt-i / Alt-o for tabs)
bind-key -n M-i swap-window -t :.- \; select-window -t :.-
bind-key -n M-o swap-window -t :.+ \; select-window -t :.+
